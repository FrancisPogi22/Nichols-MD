class ProductWidget{constructor(t,e=9){this.collection=t||"treatments",this.productList=$(".categories-product-list"),this.productsPerPage=e,this.currentPage=1,this.allProducts=[],this.totalPages=0,this.init()}init(){this.bindEvents(),this.fetchFilteredProducts()}bindEvents(){$("#priceRange").on("mouseup",()=>{let t=$("#priceRange").val();$("#minPrice").text(t),this.fetchFilteredProducts({minPrice:0,maxPrice:parseInt(t,10)})}),$("#filterBtn").click(t=>{t.preventDefault();let e=$("#skinTypeFilter").val(),r=$("#productTypeFilter").val(),i=$("#brandFilter").val(),a=$("#typeFilter").val(),s=$("#treatmentFilter").val(),c=$("#priceFilter").val(),l={};if(c){let[n,o]=c.split("-").map(Number);l={minPrice:n,maxPrice:o}}let d={skinType:e,productType:r,brand:i,...l};a&&(d.type=a),s&&(d.treatment=s),this.fetchFilteredProducts(d)}),$("#sortBy").change(t=>{let e=$(t.currentTarget).val();this.fetchFilteredProducts({sortBy:e})})}createProductWidget(t){let e=`/products/${t.handle}`,r=$("<div>",{class:"product-widget"}),i=$("<a>",{href:e}),a;a=t.images&&t.images[0]?.src?$("<img>",{src:t.images[0].src,alt:t.images[0].alt||"Product Image"}):$("<img>",{src:"https://cdn.shopify.com/s/files/1/0597/1116/0382/files/NMD_Logo.png?v=1732133643",alt:"Default Image"}),i.append(a),r.append(i);let s=$("<div>",{class:"product-details"}),c=$("<a>",{href:e}).append($("<p>").text(t.title||"Treatment Name"));parseFloat(t.variants[0].price);let l=t.variants[0]?.compare_at_price?parseFloat(t.variants[0].compare_at_price):null,n=Math.min(...t.variants.map(t=>t.price)),o=Math.max(...t.variants.map(t=>t.price)),d=$("<p>",{class:n!==o?"price-comparison":""}).append(n!==o?$("<span>").text("$"+n.toFixed(2)+" - $"+o.toFixed(2)):l&&l<n?[$("<span>").text("$"+l.toFixed(2)),$("<span>",{class:"compare-price"}).text(" $"+n.toFixed(2)).css("text-decoration","line-through"),]:$("<span>").text("$"+n.toFixed(2))),p="treatments"===this.collection?"View Service":"View Product",u=$("<a>",{href:e,class:"btn-secondary"}).text(p);return s.append(c,d,u),r.append(s),r}fetchFilteredProducts(t={},e=null){this.showLoader();let r=`/collections/${this.collection}/products.json?limit=250`;e&&(r+=`&page_info=${e}`),$.ajax({type:"GET",url:r,success:e=>{let r=e.products;switch(this.allProducts=r.filter(e=>{let r=parseFloat(e.variants[0].price),i=(void 0===t.minPrice||r>=t.minPrice)&&(void 0===t.maxPrice||r<=t.maxPrice),a=!t.skinType||e.tags?.includes(t.skinType),s=!t.productType||e.tags?.includes(t.productType),c=!t.brand||e.tags?.includes(t.brand),l=!t.type||e.tags?.includes(t.type),n=!t.treatment||e.tags?.includes(t.treatment);return i&&a&&s&&c&&l&&n}),t.sortBy){case"title-asc":this.allProducts.sort((t,e)=>t.title.localeCompare(e.title));break;case"title-desc":this.allProducts.sort((t,e)=>e.title.localeCompare(t.title));break;case"price-asc":this.allProducts.sort((t,e)=>parseFloat(t.variants[0].price)-parseFloat(e.variants[0].price));break;case"price-desc":this.allProducts.sort((t,e)=>parseFloat(e.variants[0].price)-parseFloat(t.variants[0].price));case"best-seller":this.allProducts=this.allProducts.filter(t=>t.tags?.includes("Best Seller"))}this.totalPages=Math.ceil(this.allProducts.length/this.productsPerPage),this.currentPage=1,this.renderProducts(),this.renderPagination(),this.hideLoader()},error:(t,e,r)=>{console.error("Error fetching collection data:",r),this.hideLoader()}})}renderPagination(){let t=$(".pagination-container");if(t.empty(),this.totalPages>1){let e=$("<ul>",{class:"pagination"});for(let r=1;r<=this.totalPages;r++){let i=$("<span>",{class:r===this.currentPage?"pagination-current":""}),a=$("<a>",{href:"#!",text:r,class:r!==this.currentPage?"pagination-link":"","data-page":r});i.append(a),e.append(i)}t.append(e),$(".pagination-link").click(t=>{t.preventDefault();let e=$(t.currentTarget).data("page");this.currentPage=e,this.renderProducts(),this.renderPagination()})}}renderProducts(){this.productList.empty();let t=(this.currentPage-1)*this.productsPerPage,e=t+this.productsPerPage,r=this.allProducts.slice(t,e);r.length>0?r.forEach(t=>{let e=this.createProductWidget(t);this.productList.append(e)}):this.productList.append($("<p>",{class:"no-products-message",text:"No products found with the selected filters."}))}showLoader(){$(".product-loader").removeClass("loader--hidden")}hideLoader(){$(".product-loader").addClass("loader--hidden")}}